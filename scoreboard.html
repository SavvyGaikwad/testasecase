<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Score Board</title>
  <style>
    /* Your styling remains the same */
  </style>
</head>
<body>
  <div class="score-board">
    <h1 id="welcome-message"></h1>
    <table>
      <thead>
        <tr>
          <th>Sr. No.</th>
          <th>Username</th>
          <th>Game Name</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody id="score-table-body">
        </tbody>
    </table>
    <button class="button" onclick="window.location.href='landing.html'">
      Go to Games
    </button>
  </div>

  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.12.min.js"></script>
  <script>
    // Replace with your actual values from a secure configuration source
    const REGION = 'eu-north-1';
    const TABLE_NAME = 'GameScores';

    AWS.config.update({
      region: REGION
    });

    const dynamoDB = new AWS.DynamoDB.DocumentClient();

    // Retrieve URL parameters
    const params = new URLSearchParams(window.location.search);
    const username = params.get('username');
    const gameName = params.get('gameName');
    const score = parseInt(params.get('score'));

    // Display welcome message
    if (username) {
      document.getElementById('welcome-message').textContent = `Welcome ${username}`;
    } else {
      document.getElementById('welcome-message').textContent = 'Welcome Guest';
    }

    // Function to save score in DynamoDB
    function saveScore(username, gameName, score) {
      const timestamp = new Date().toISOString();
      const params = {
        TableName: TABLE_NAME,
        Item: {
          username: username,
          gameName: gameName,
          score: score,
          timestamp: timestamp
        }
      };

      dynamoDB.put(params, (err, data) => {
        if (err) {
          console.error("Error saving score:", JSON.stringify(err, null, 2));
          // Display a user-friendly error message here
          document.getElementById('welcome-message').textContent = 'Error saving score. Please try again later.';
        } else {
          console.log("Score saved successfully:", JSON.stringify(data, null, 2));
          displayScores();
        }
      });
    }

    // Function to display scores in the table
    function displayScores() {
      const params = {
        TableName: TABLE_NAME
      };

      dynamoDB.scan(params, (err, data) => {
        if (err) {
          console.error("Unable to scan the table. Error:", JSON.stringify(err, null, 2));
          // Display a user-friendly error message here
          const scoreTableBody = document.getElementById('score-table-body');
          scoreTableBody.innerHTML = '<tr><td colspan="4">Error fetching scores. Please try again later.</td></tr>';
        } else {
          const scoreTableBody = document.getElementById('score-table-body');
          scoreTableBody.innerHTML = ''; // Clear current scores

          if (data.Items.length === 0) {
            scoreTableBody.innerHTML = '<tr><td colspan="4">No scores yet!</td></tr>';
          } else {
            data.Items.forEach((scoreEntry, index) => {
              const row = document.createElement('tr');
              row.innerHTML = `<td>${index + 1}</td><td>${scoreEntry.username}</td><td>${scoreEntry.gameName}</td><td>${scoreEntry.score}</td>`;
              scoreTableBody.appendChild(row);
            });
          }
        }
      });
    }

    // Validate parameters and save the score if valid
    if (gameName && !isNaN(score) && score >= 0) {
      saveScore(username || 'Guest', gameName, score); // Save to DynamoDB
      displayScores();
    } else {
      console.warn('Invalid parameters. Please ensure that all parameters (username, gameName, score) are provided and score is a valid number.');
      document.getElementById('welcome-message').textContent = 'Invalid Score Submission';
    }
  </script>
</body>
</html>
